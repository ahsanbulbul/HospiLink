{% load static %}
<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="{% static 'app_logo_3.png' %}" type="image/png">
    <link href="https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    {% comment %} <link rel="stylesheet" href="{% static 'style.css' %}"> {% endcomment %}



    <style>
        /* Google Fonts - Poppins */
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap");

        .card {
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
            margin-top: 20px;
            border-radius: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 15px 20px;
            width: 95%;
            min-height: 120px;
            gap: 20px;
        }


        .search_container {
            display: flex;
            flex-direction: row;
            border: #000000 1px solid;
            margin-top: 30px;
            width: 90%;
            justify-content: space-between;
        }

        .filter_section {
            display: flex;
            flex-direction: column;
            background-color: #f0f8ff;
            /* Light blue */
            padding: 10px;
            margin-left: 20px;
            border: #000000 1px solid;
        }

        .list_section {
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
            /* Light beige */
            padding: 10px;
            border: #000000 1px solid;
            margin-right: 20px;
        }



        .card_img {
            flex: 0 0 100px;
            /* Fixed width of 100px, won't grow or shrink */

        }

        .card_identity {
            flex: 0 0 250px;
            /* Fixed width of 200px */
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
        }

        .card_details {
            flex: 0 0 300px;
            /* Fixed width of 300px */
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
        }

        .card_appointment {
            flex: 0 0 170px;
            /* Fixed width of 150px */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            text-align: right;
        }

        /* Example card styling */
        .card-title {
            margin: 0;
            font-size: 1.2em;
            line-height: 1.4;
        }

        .card-text {
            margin: 5px 0;
            line-height: 1.3;
        }

        .btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;

            font-size: 15px;
        }

        .modify-btn {
            background-color: #7b8fde;
            color: white;
            margin-right: 5px;
        }

        .modify-btn:hover {
            background-color: #617be4;
            color: white;
        }

        .attend-btn {
            background-color: #7b8fde;
            color: white;
            margin-right: 5px;
        }

        .attend-btn:hover {
            background-color: #617be4;
            color: white;
        }

        .delete-btn {
            background-color: #dd636e;
            color: white;
        }

        .delete-btn:hover {
            background-color: #c5555e;
            color: white;
        }

        /* search button styling */

        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 20px 0;
            /* Changed from 'margin: 20px auto' to remove center alignment */
        }

        .search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .search-wrapper:hover,
        .search-wrapper:focus-within {
            box-shadow: 0 4px 8px rgba(221, 99, 110, 0.2);
        }

        .search-input {
            width: 100%;
            height: 48px;
            padding: 0 48px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            transition: all 0.3s ease;
            font-family: "Poppins", sans-serif;
        }

        .search-input:focus {
            outline: none;
            border-color: #dd636e;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-btn {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 48px;
            height: 48px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .search-btn i {
            color: #999;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .search-wrapper:focus-within .search-btn i {
            color: #dd636e;
        }

        .search-input::-webkit-search-cancel-button {
            position: relative;
            right: 10px;
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23999'><path d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/></svg>") no-repeat 50% 50%;
            cursor: pointer;
        }

        /* Add these styles to properly position within your list section */
        .list_section .search.doctor {
            width: 100%;
            padding: 20px 0;
        }


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }

        body {
            min-height: 100%;
            background: #ffffff;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            height: 70px;
            width: 100%;
            display: flex;
            align-items: center;
            z-index: 1000; /* Ensure nav is above other elements */
        }

        nav .logo {
            display: flex;
            align-items: center;
            margin: 0 24px;
        }

        .logo .menu-icon {
            color: #dd636e;
            font-size: 24px;
            margin-right: 14px;
            cursor: pointer;
        }

        .logo .logo-name {
            color: #dd636e;
            font-size: 22px;
            font-weight: 500;
        }

        nav .sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            height: 100%;
            width: 260px;
            padding: 20px 0;
            background-color: #ffffff;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            z-index: 1001; /* Higher than nav */
        }

        nav.open .sidebar {
            left: 0;
        }

        .sidebar .sidebar-content {
            display: flex;
            height: 100%;
            flex-direction: column;
            justify-content: space-between;
            padding: 30px 16px;
        }

        .sidebar-content .list {
            list-style: none;
        }

        .list .nav-link {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 14px 12px;
            border-radius: 8px;
            text-decoration: none;
        }

        .lists .nav-link:hover {
            background-color: #c5555e;
        }

        .nav-link .icon {
            margin-right: 14px;
            font-size: 20px;
            color: #000000;
        }

        .nav-link .link {
            font-size: 16px;
            color: #000000;
            font-weight: 400;
        }

        .lists .nav-link:hover .icon,
        .lists .nav-link:hover .link {
            color: #fff;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: -100%;
            height: 1000vh;
            width: 200%;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s ease;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999; /* Lower than nav but higher than content */
        }

        nav.open~.overlay {
            opacity: 1;
            left: 260px;
            pointer-events: auto;
        }

        .content {
            margin-top: 10px;
            /* Adjust this value based on your navbar height */
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .container.mt-3 {
            margin-top: 100px !important;
            /* Moves dropdown lower */
            padding-left: 20px;
            padding-right: 20px;
        }

        .container.mt-5 {
            position: relative;
            z-index: 1; /* Lowest z-index */
        }

        #blood-group-select {
            width: 200px !important;
            /* Optional: set a specific width */
            margin-right: 20px;
            /* Optional: add some right margin */
        }

        /* styles for form & prescription */


        #prescription-form,
        #prescriptionTemplate {
            box-shadow:
                0px 0px 2.2px rgba(0, 0, 0, 0.07),
                0px 0px 5.3px rgba(0, 0, 0, 0.05),
                0px 0px 10px rgba(0, 0, 0, 0.042),
                0px 0px 17.9px rgba(0, 0, 0, 0.035),
                0px 0px 33.4px rgba(0, 0, 0, 0.028),
                0px 0px 80px rgba(0, 0, 0, 0.02) !important;

            background: white !important;
        }

        input,
        textarea,
        select,
        .btn {
            text-decoration: none !important;
            outline: 0 !important;
            box-shadow: none !important;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: #0d6efd !important;
        }

        #prescriptionTemplate {
            display: none;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            max-width: 800px; /* Constrain the width */
            box-shadow: 0px 0px 2.2px rgba(0, 0, 0, 0.07),
                        0px 0px 5.3px rgba(0, 0, 0, 0.05),
                        0px 0px 10px rgba(0, 0, 0, 0.042),
                        0px 0px 17.9px rgba(0, 0, 0, 0.035),
                        0px 0px 33.4px rgba(0, 0, 0, 0.028),
                        0px 0px 80px rgba(0, 0, 0, 0.02);
            background: white;
            border-radius: 8px; /* Optional: Add rounded corners */
            overflow: hidden; /* Prevent content from overflowing */
        }

        #prescriptionTemplate .container {
            margin: 0 auto;
            padding: 10px 20px;
            width: 100%;
            box-sizing: border-box; /* Include padding in width calculations */
        }

        #prescriptionTemplate .d-flex {
            flex-wrap: wrap; /* Ensure content wraps if it exceeds the container width */
            justify-content: space-between; /* Distribute content evenly */
        }

        #prescriptionTemplate p, #prescriptionTemplate span {
            word-wrap: break-word; /* Prevent long text from overflowing */
            overflow-wrap: break-word;
        }

        #prescriptionTemplate .text-center {
            text-align: center;
        }

        #prescriptionTemplate .justify-content-end {
            justify-content: flex-end;
        }

        @media (max-width: 767.5px) {
            .prescription {
                margin-top: 2rem !important;
            }
        }

        /* Initially hide the "Go Back" button */
        #goBackButton {
            display: none;
        }

        #prescriptionForm {
            position: relative; /* Ensure the form respects z-index */
            z-index: 1; /* Lower z-index than the sidebar */
            background: white; /* Ensure the form has a background */
            box-shadow: 0px 0px 2.2px rgba(0, 0, 0, 0.07),
                        0px 0px 5.3px rgba(0, 0, 0, 0.05),
                        0px 0px 10px rgba(0, 0, 0, 0.042),
                        0px 0px 17.9px rgba(0, 0, 0, 0.035),
                        0px 0px 33.4px rgba(0, 0, 0, 0.028),
                        0px 0px 80px rgba(0, 0, 0, 0.02);
            padding: 20px;
            border-radius: 8px;
        }

        @media print {
            /* Hide unnecessary elements */
            nav, .overlay, #title, #prescriptionForm, .btn, #prescriptionHeading, .content {
                display: none !important;
            }
    
            /* Ensure the prescription template is visible */
            #prescriptionTemplate {
                display: block !important;
                margin: 0;
                padding: 20px;
                width: 100%;
                box-shadow: none;
            }
    
            /* Center the prescription content */
            #prescriptionTemplate .container {
                margin: 0 auto;
                width: 100%;
            }
    
            /* Adjust font sizes for printing */
            body {
                font-size: 12px;
                line-height: 1.5;
            }
    
            h1, h2, h3 {
                font-size: 16px;
                text-align: center;
            }
    
            p, span {
                font-size: 12px;
            }
    
            /* Remove background colors and shadows */
            * {
                background: none !important;
                box-shadow: none !important;
            }
    
            /* Ensure the prescription content fits on the page */
            .container {
                page-break-inside: avoid;
            }
    
            /* Add page breaks for long content */
            .page-break {
                page-break-before: always;
            }
        }

        body {
            font-family: 'Montserrat', sans-serif !important;
            background-color: #f6f6f6 !important;
        }
        
        #prescription-form,
        #prescriptionTemplate {
            box-shadow:
                0px 0px 2.2px rgba(0, 0, 0, 0.07),
                0px 0px 5.3px rgba(0, 0, 0, 0.05),
                0px 0px 10px rgba(0, 0, 0, 0.042),
                0px 0px 17.9px rgba(0, 0, 0, 0.035),
                0px 0px 33.4px rgba(0, 0, 0, 0.028),
                0px 0px 80px rgba(0, 0, 0, 0.02);
        
            background: white;
            border-radius: 8px; /* Add rounded corners */
            padding: 20px;
            max-width: 800px; /* Constrain the width */
            margin: 0 auto; /* Center the container */
        }
        
        input,
        textarea,
        select,
        .btn {
            text-decoration: none;
            outline: 0;
            box-shadow: none;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            border-color: #0d6efd;
        }
        
        #prescriptionTemplate {
            display: none;
        }
        
        #prescriptionTemplate h1 {
            color: rgb(0, 170, 255);
            font-size: 24px;
            text-align: center;
        }
        
        .one,
        .two {
            color: rgb(0, 170, 255);
            height: 0.15rem;
            margin: 10px 0;
        }
        
        #prescriptionTemplate p {
            margin-bottom: 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        #nameT,
        #ageT,
        #genderT,
        #addressT,
        #dateT {
            color: #0d6efd;
            font-weight: bold;
        }
        
        .mail a {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        .mail a:hover {
            color: #0d6efd;
            text-decoration: underline;
        }
        
        @media (max-width: 767.5px) {
            .prescription {
                margin-top: 2rem;
            }
        }
    </style>

    <title>Doctor Dashboard</title>
</head>

<body>
    <nav>
        <div class="logo">
            <i class="bx bx-menu menu-icon"></i>
            <!-- <span class="logo-name">HospiLinkdf</span> -->
        </div>
        <div class="sidebar">
            <div class="logo">
                <i class="bx bx-menu menu-icon"></i>
                <span class="logo-name"><b>HospiLink</b></span>
            </div>

            <div class="sidebar-content">
                <ul class="lists">
                    <li class="list">
                        <a href="{% url 'index' %}" class="nav-link">
                            <i class="bx bx-home-alt icon"></i>
                            <span class="link">Dashboard</span>
                        </a>
                    </li>
                    <li class="list">
                        <a href="{% url 'search_doctor' %}" class="nav-link">
                            <i class="bx bx-search icon"></i>
                            <span class="link">Search Doctor</span>
                        </a>
                    </li>
                    <li class="list">
                        <a href="{% url 'previous_appointments' %}" class="nav-link">
                            <i class="bx bx-history icon"></i>
                            <span class="link">Appointment History</span>
                        </a>
                    </li>
                    <li class="list">
                        <a href="{% url 'blood_repo' %}" class="nav-link">
                            <i class="bx bx-droplet icon"></i>
                            <span class="link">Blood Repo</span>
                        </a>
                    </li>
                </ul>

                <div class="bottom-content">
                    <li class="list">
                        <a href="#" class="nav-link">
                            <i class="bx bx-cog icon"></i>
                            <span class="link">Settings</span>
                        </a>
                    </li>
                    <li class="list">
                        <a href="#" class="nav-link" onclick="window.location.href='/user_authentication/'">
                            <i class="bx bx-log-out icon"></i>
                            <span class="link">Logout</span>
                        </a>
                    </li>
                </div>
            </div>
        </div>
    </nav>

    <section class="overlay"></section>

    <div class="content">
        <h2>Attend Appointment</h2>
    </div>

    <div class="container mt-5">
        <div class="container mx-auto p-3 mt-4" id="prescriptionForm">
            <div class="row">
                <div class="col-md-6">
                    <h3 class="text-center">Patient Details :</h3>
                    <div class="form-group">
                        <label for="name">Patient Name:</label>
                        <input type="text" class="form-control" id="name" value="{{ patient.name }}" disabled>
                    </div>
                    
                    <div class="form-group mt-3">
                        <label for="age">Patient Age:</label>
                        <input type="number" class="form-control" id="age" value="{{ patient.age }}" disabled>
                    </div>
                    
                    <div class="form-group mt-3">
                        <label for="gender">Gender:</label>
                        <select class="form-select" aria-label="Default select example" id="gender" disabled>
                            <option value="Male" {% if patient.gender == "Male" %}selected{% endif %}>Male</option>
                            <option value="Female" {% if patient.gender == "Female" %}selected{% endif %}>Female</option>
                            <option value="Other" {% if patient.gender == "Other" %}selected{% endif %}>Other</option>
                        </select>
                    </div>

                    <div class="form-group mt-3">
                        <label for="date">Date :</label>
                        <input type="date" class="form-control" id="date" value="{{ patient.appointment_date }}" disabled>
                    </div>

                    <div class="form-group mt-3">
                        <label for="address">Phone Number:</label>
                        <input type="text" class="form-control" id="address" value="{{ patient.phone_no }}" disabled>
                    </div>

                    <div class="form-group mt-3">
                        <label for="blood_group">Blood Group:</label>
                        <input type="text" class="form-control" id="blood_group" value="{{ patient.blood_group }}" disabled>
                    </div>
                    
                    <div class="form-group mt-3">
                        <label for="complexities">Complexities:</label>
                        <textarea class="form-control" id="complexities" rows="3" disabled>{{ patient.complexities }}</textarea>
                    </div>
                </div>

                <div class="col-md-6">
                    <h3 class="text-center prescription">Prescription :</h3>

                    <div class="form-group mt-3" id="mn">
                        <label for="medicalNotes">Diagnosis :</label>
                        <textarea class="form-control note-field" id="medicalNotes" rows='2'></textarea>
                        <div class="gap-2 d-flex justify-content-end mt-2 ms-auto">
                            <button onclick="addNewMNField()" class="btn btn-success" id="mnAdd"
                                type="button">Add</button>
                            <button onclick="delNewMNField()" class="btn btn-danger" id="mnDel" type="button">
                                Delete
                            </button>
                        </div>
                    </div>

                    <hr>

                    <div class="form-group mt-3" id="md">
                        <label for="medicineDetails">Medicine Details :</label>
                        <textarea class="form-control detail-field" id="medicineDetails" rows='2'></textarea>
                        <div class="gap-2 d-flex justify-content-end mt-2 ms-auto">
                            <button onclick="addNewMDField()" class="btn btn-success" id="mdAdd"
                                type="button">Add</button>
                            <button onclick="delNewMDField()" class="btn btn-danger" id="mdDel" type="button">
                                Delete
                            </button>
                        </div>
                    </div>
                    <div class="form-group mt-3">
                        <label for="additional_notes">Additional Notes:</label>
                        <textarea class="form-control" id="additional_notes" rows="3" placeholder="Enter any additional notes"></textarea>
                    </div>
                </div>
            </div>
            <hr>
            <button onclick="generatePrescription()" class="btn btn-dark d-flex justify-content-center mx-auto mt-2">
                Generate Prescription
            </button>
        </div>

        <!-- Prescription Template -->
        <div class="container p-4 mt-2" id="prescriptionTemplate">
            <h3 id="prescriptionHeading" class="text-center">Prescription Preview</h3>
            <input type="hidden" id="appointment_id" value="{{ appointment.0 }}">
            <button id="goBackButton" onclick="goBackToForm()" class="btn btn-secondary d-flex justify-content-start ms-auto mt-3">
                Go Back
            </button>
            <div class="text-center">
                <h1 class="fw-bold mb-4">Oblivious Hospital</h1>
                <span class="fs-3 fw-bolder mt-5"><b>Dr. {{ doctor.name }}</b></span>
                <span class="fs-5"><i>{{ doctor.degrees }}</i></span>
                <p class="mt-3">45/2 Lake View Road, Dhanmondi</p>
                <p>Dhaka 1209, Bangladesh</p>
                <p>PH: +880 1712 345678</p>
                <p>FAX: +880 2 9111234</p>
            </div>
            <hr class="one">
            <div class="container output mt-5">
                <div class="container">
                    <div class="d-flex patient-detail col-md-12 gap-2 justify-content-between">
                        <p>
                            Patient Name:
                            <span id="nameT"></span>
                        </p>
                        <p>Age: <span id="ageT"></span></p>
                        <p>Gender: <span id="genderT"></span></p>
                    </div>

                    <div class="d-flex col patient-detail gap-2 justify-content-between mt-3">
                        <p>
                            Address:
                            <span id="addressT"></span>
                        </p>
                        <p>
                            Date:
                            <span id="dateT"></span>
                        </p>
                    </div>

                    <div class="mt-4">
                        <span class="fs-1">R</span><span class="fs-4">x</span>
                    </div>

                    <div class="mx-5 mt-5">
                        <p class="fs-4">Diagnosis:</p>
                        <ul id="medicalNotesT">
                            <li></li>
                        </ul>
                    </div>

                    <div class="mx-5 mt-5">
                        <p class="fs-4">Medicine Details:</p>
                        <ol id="medicineDetailsT">
                            <li></li>
                        </ol>
                    </div>

                    <div class="mt-5 d-flex justify-content-end me-5">
                        <p>Doctor's Signature: <span class="text-primary">Dr. {{ doctor.name }}</span></p>
                    </div>

                    <hr class="two">
                    <p class="text-center mail">
                        <a href="mailto:info@obliviousgroup.com">info@obliviousgroup.com</a>
                    </p>
                </div>
            </div>

            <div class="d-flex justify-content-end gap-2 mt-3">
                <button onclick="savePrescription()" id="savePrescriptionButton" class="btn btn-primary">
                    Save Prescription
                </button>
                <button onclick="printPrescription()" class="btn btn-dark">
                    Print Prescription
                </button>
            </div>
        </div>
    </div>

    <!-- Add Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    

    <!-- Script to dynamically generate table rows -->
    <script>
        const navBar = document.querySelector("nav"),
            menuBtns = document.querySelectorAll(".menu-icon"),
            overlay = document.querySelector(".overlay");

        menuBtns.forEach((menuBtn) => {
            menuBtn.addEventListener("click", () => {
                navBar.classList.toggle("open");
            });
        });

        overlay.addEventListener("click", () => {
            navBar.classList.remove("open");
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Ensure the "Go Back" button is hidden when the page loads
            const goBackButton = document.getElementById('goBackButton');
            if (goBackButton) {
                goBackButton.style.display = 'none';
            }
        });

        // Prescription Tool JavaScript
        console.log('Welcome to The Prescription Tool');

        // ADD MEDICAL NOTE FIELD
        function addNewMNField() {
            let newNode = document.createElement('textarea');
            newNode.classList.add('form-control');
            newNode.classList.add('mt-2');
            newNode.classList.add('note-field');
            newNode.setAttribute('rows', '1');
            newNode.setAttribute('placeholder', 'Enter New Note');

            let mn = document.getElementById('mn');
            let mnAdd = document.getElementById('mnAdd');

            mn.insertBefore(newNode, mnAdd[0]);
        }

        // DELETE MEDICAL NOTE FIELD
        function delNewMNField() {
            let deleteNode = document.getElementsByClassName('note-field');
            deleteNode[1].remove();
        }

        // ADD MEDICINE DETAILS FIELD
        function addNewMDField() {
            let newNode2 = document.createElement('textarea');
            newNode2.classList.add('form-control');
            newNode2.classList.add('mt-2');
            newNode2.classList.add('detail-field');
            newNode2.setAttribute('rows', '1');
            newNode2.setAttribute('placeholder', 'Enter New Medicine  Detail');

            let md = document.getElementById('md');
            let mdAdd = document.getElementById('mdAdd');

            md.insertBefore(newNode2, mdAdd[0]);
        }

        // DELETE MEDICINE DETAILS FIELD
        function delNewMDField() {
            let deleteNode = document.getElementsByClassName('detail-field');
            deleteNode[1].remove();
        }

        // GENERATE PRESCRIPTION
        function generatePrescription() {
            // NAME
            let name = document.getElementById('name').value;
            let nameT = document.getElementById('nameT');
            nameT.innerHTML = name;

            // AGE
            let age = document.getElementById('age').value;
            let ageT = document.getElementById('ageT');
            ageT.innerHTML = age;

            // GENDER
            let gender = document.getElementById('gender').value;
            let genderT = document.getElementById('genderT');
            genderT.innerHTML = gender;

            // ADDRESS
            let address = document.getElementById('address').value;
            let addressT = document.getElementById('addressT');
            addressT.innerHTML = address;

            // DATE
            let date = document.getElementById('date').value;
            let dateT = document.getElementById('dateT');
            dateT.innerHTML = date;

            // MEDICAL NOTE
            let medicalNotes = document.getElementsByClassName('note-field');
            let str1 = '';
            for (let i of medicalNotes) {
                str1 = str1 + `<li>${i.value}</li>`;
            }
            let medicalNotesT = document.getElementById('medicalNotesT');
            medicalNotesT.innerHTML = str1;

            // MEDICINE DETAILS
            let medicineDetails = document.getElementsByClassName('detail-field');
            let str2 = '';
            for (let j of medicineDetails) {
                str2 = str2 + `<li>${j.value}</li>`;
            }
            let medicineDetailsT = document.getElementById('medicineDetailsT');
            medicineDetailsT.innerHTML = str2;

            // DISPLAY PRESCRIPTION and HIDE FORM & TITLE
            document.getElementById('prescriptionForm').style.display = 'none';
            document.getElementById('prescriptionTemplate').style.display = 'block';



            // Update heading and show "Go Back" button
            document.getElementById('prescriptionHeading').innerText = 'Prescription Preview';
        }


        // PRINT PRESCRIPTION
        function printPrescription() {
            window.print();
        }

        function goBackToForm() {
            const prescriptionTemplate = document.getElementById("prescriptionTemplate");
            const prescriptionForm = document.getElementById("prescriptionForm");
            const saveButton = document.getElementById("savePrescriptionButton");
    
            // Hide the prescription template and save button
            prescriptionTemplate.style.display = "none";
            saveButton.style.display = "none";

            if (saveButton) {
                saveButton.style.display = "inline-block";
            }
    
            // Show the prescription form
            prescriptionForm.style.display = "block";
        }
    
        // Function to save the prescription
        function savePrescription() {
            const appointmentIdElement = document.getElementById("appointment_id");
            if (!appointmentIdElement) {
                alert("Error: Appointment ID is missing.");
                return;
            }
        
            const prescriptionData = {
                appointment_id: appointmentIdElement.value,
                prescribed_by: "{{ appointment.2 }}",
                prescribed_to: "{{ appointment.1 }}",
                diagnosis: document.getElementById("medicalNotes")?.value || "",
                medication: document.getElementById("medicineDetails")?.value || "",
                additional_notes: document.getElementById("additional_notes")?.value || "",
            };

            console.log(prescriptionData);
        
            fetch("/doctor/save_prescription/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCookie("csrftoken"),
                },
                body: JSON.stringify(prescriptionData),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        alert("Prescription saved successfully!");
                    } else {
                        alert("Error: " + data.message);
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
        }
    
        // Utility function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                const cookies = document.cookie.split(";");
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === name + "=") {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    
        // Ensure the "Save Prescription" button is hidden initially
        document.addEventListener("DOMContentLoaded", function () {
            const prescriptionTemplate = document.getElementById("prescriptionTemplate");
            const saveButton = document.getElementById("savePrescriptionButton");

            // Ensure the prescription template and save button are hidden initially
            if (prescriptionTemplate) {
                prescriptionTemplate.style.display = "none";
            }
        });
    </script>
</body>

</html>